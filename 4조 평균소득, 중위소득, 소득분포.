import matplotlib.pyplot as plt

# Define the income categories to plot
income_category_bar = '평균소득'
income_category_line = '하위 80% 경계값(P80)'

# Extract data for the chosen income category for the bars (Average Income)
income_data_row = df[df['항목'] == income_category_bar]

# Get years from column names (excluding the '항목' column) and convert to integers
years = income_data_row.columns[1:].astype(int)

# Get income values for the selected row (Average Income)
avg_income_values = income_data_row.iloc[0, 1:].values

# Extract data for the lower 80% boundary value for the line graph
p80_data_row = df[df['항목'] == income_category_line]
p80_values = p80_data_row.iloc[0, 1:].values

x = years
y_bar = avg_income_values
y_line = p80_values

plt.figure(figsize=(12, 7))

# Plot bars for Average Income
plt.bar(x, y_bar, color='skyblue', label=income_category_bar)

# Plot line for P80 values
plt.plot(x, y_line, color='red', marker='o', linestyle='-', label=income_category_line)

plt.title(f'연도별 {income_category_bar} 및 {income_category_line}') # Dynamic title reflecting both data series
plt.xlabel('연도')
plt.ylabel('소득')
plt.xticks(rotation=45) # Rotate x-axis labels for better readability if needed

# Add numerical values on top of the bars and line points
for year, avg_income, p80_value in zip(x, y_bar, y_line):
    # Average income value (above the bar)
    plt.text(year, avg_income + 5, f'{avg_income:,.0f}', ha='center', va='bottom', fontsize=9, color='black')
    # P80 value (above the line point)
    plt.text(year, p80_value + 5, f'{p80_value:,.0f}', ha='center', va='bottom', fontsize=9, color='red')

# Adjust y-axis limits dynamically based on the maximum of both data series
max_overall_val = max(max(y_bar), max(y_line))
min_overall_val = min(min(y_bar), min(y_line))

# Set y-axis ticks in increments of 100, starting from 0
max_tick = int((max_overall_val // 100) + 1) * 100
plt.yticks(range(0, max_tick + 100, 100))

plt.ylim(0, max_overall_val * 1.2)

plt.legend() # Show legend for both bar and line
plt.tight_layout() # Adjust layout to prevent labels from overlapping
plt.show()
